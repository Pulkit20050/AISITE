<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Reading Journey</title>
  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet" />
  <style>
    /* Global Styles & Reset */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    :root {
      /* Dark Theme Variables */
      --bg-dark-primary: #1a1a2e;
      --bg-dark-secondary: #16213e;
      --bg-dark-tertiary: #0f3460;
      --text-light: #e3e3e3;
      --text-medium: #a0a0a0;
      --accent-primary: #e94560;
      --accent-secondary: #16c79a; /* Green for progress/growth */
      --card-bg: #2c2c54;
      --border-color: #4a4a7a;
      --hero-gradient-start: var(--bg-dark-tertiary);
      --hero-gradient-end: var(--accent-primary);
      --tab-inactive-bg: #2a2a4a;
      --tab-active-bg: var(--bg-dark-secondary);
      --tab-border: var(--border-color);
    }
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, var(--bg-dark-primary), var(--bg-dark-secondary));
      color: var(--text-light);
      line-height: 1.6;
      min-height: 100vh;
    }
    .container {
      padding: 20px;
      max-width: 950px;
      margin: 0 auto;
      /* Extra top margin to ensure content isn't hidden by modal/fixed elements */
      margin-top: 120px;
    }
    /* Hero Section */
    .hero-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100vh;
      background: linear-gradient(135deg, var(--hero-gradient-start), var(--hero-gradient-end));
      color: white;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      transition: transform 0.8s ease, height 0.8s ease;
      z-index: 10;
      text-align: center;
    }
    .hero-container.shrink {
      transform: translateY(-20px);
      height: 80px;
    }
    .hero-title {
      font-size: 3.5rem;
      margin: 0 10px;
      transition: font-size 0.8s ease;
      text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);
    }
    .hero-container.shrink .hero-title {
      font-size: 1.8rem;
    }
    .hero-button {
      margin-top: 25px;
      padding: 15px 35px;
      border: none;
      border-radius: 50px;
      background: #fff;
      color: var(--accent-primary);
      font-size: 1.2rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.2s ease, color 0.3s ease;
      box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
    }
    .hero-button:hover {
      background: #f0f0f0;
      color: var(--hero-gradient-start);
      transform: scale(1.05);
    }
    /* Floating Add Book Button */
    .floating-add-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--accent-secondary);
      color: #fff;
      padding: 12px 18px;
      border: none;
      border-radius: 50px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      z-index: 12;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      transition: transform 0.2s ease;
    }
    .floating-add-btn:hover {
      transform: scale(1.05);
    }
    /* Theme Toggle */
    .theme-toggle {
      position: fixed;
      top: 15px;
      right: 15px;
      padding: 8px 12px;
      border: none;
      border-radius: 4px;
      background: var(--accent-secondary);
      color: white;
      cursor: pointer;
      z-index: 11;
      transition: background 0.3s ease, transform 0.2s ease;
    }
    .theme-toggle:hover {
      background: #11a880;
      transform: scale(1.1);
    }
    /* Last Visited & Motivational Quote */
    #lastVisited {
      margin-bottom: 15px;
      font-size: 0.9rem;
      color: var(--text-medium);
      text-align: right;
      opacity: 0.8;
    }
    .motivational-quote {
      background: var(--card-bg);
      border-left: 5px solid var(--accent-secondary);
      padding: 15px 20px;
      margin-bottom: 20px;
      border-radius: 8px;
      text-align: center;
      font-style: italic;
      color: var(--text-medium);
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }
    .motivational-quote p { margin: 0; font-size: 1rem; }
    /* Achievement Section (Growth Tree) */
    .achievement {
      background: var(--card-bg);
      border: 2px dashed var(--accent-secondary);
      border-radius: 10px;
      padding: 20px;
      text-align: center;
      margin-bottom: 25px;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
    }
    .achievement h3 {
      margin-bottom: 8px;
      font-size: 1.4rem;
      color: var(--accent-secondary);
    }
    .achievement p {
      font-size: 1rem;
      color: var(--text-medium);
      margin-bottom: 10px;
    }
    .achievement .treeGraphic {
      margin: 5px auto;
      max-width: 150px;
      height: auto;
    }
    .treeGraphic svg line, .treeGraphic svg rect { stroke: #a1887f; fill: #a1887f; }
    .treeGraphic svg circle { fill: var(--accent-secondary); }
    .treeGraphic svg .leaf-dark { fill: #14a37f; }
    /* Tabs */
    .tabs {
      display: flex;
      border-bottom: 2px solid var(--tab-border);
      margin-bottom: 20px;
      background-color: var(--bg-dark-secondary);
      border-radius: 8px 8px 0 0;
      overflow: hidden;
    }
    .tab {
      padding: 12px 20px;
      cursor: pointer;
      background: var(--tab-inactive-bg);
      flex-grow: 1;
      text-align: center;
      border-right: 1px solid var(--tab-border);
      transition: background 0.3s ease, color 0.3s ease;
      color: var(--text-medium);
      font-weight: 500;
    }
    .tab:last-child { border-right: none; }
    .tab:hover { background: var(--card-bg); color: var(--text-light); }
    .tab.active {
      background: var(--tab-active-bg);
      border-bottom: 2px solid var(--accent-primary);
      color: var(--text-light);
      position: relative;
      top: 2px;
      margin-bottom: -2px;
    }
    .tab-content { display: none; }
    .tab-content.active { display: block; background: var(--bg-dark-secondary); padding: 20px; border-radius: 0 0 8px 8px; border: 1px solid var(--tab-border); border-top: none; margin-top: -2px; }
    /* Library / Bookshelf Tab Content */
    .category-card {
      background: var(--card-bg);
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.25);
      transition: transform 0.2s ease;
    }
    .category-card:hover { transform: translateY(-3px); }
    .category-card h3 {
      color: var(--accent-secondary);
      font-size: 1.3rem;
      margin-bottom: 15px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--border-color);
    }
    .category-card ul { list-style: none; padding: 0; }
    .book-item {
      background: var(--bg-dark-secondary);
      margin-bottom: 15px;
      padding: 15px;
      border-radius: 8px;
      border: 1px solid var(--border-color);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .book-item:hover { transform: translateY(-3px); box-shadow: 0 5px 12px rgba(0, 0, 0, 0.3); }
    .book-item h4 { font-size: 1.1rem; color: var(--text-light); margin-bottom: 10px; }
    .book-details {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      font-size: 0.85rem;
      color: var(--text-medium);
      margin-bottom: 10px;
      align-items: center;
    }
    .book-details small { background: var(--bg-dark-tertiary); padding: 3px 8px; border-radius: 4px; }
    .book-details .streak { color: var(--accent-secondary); font-weight: 600; }
    .progress-bar-container {
      background-color: var(--border-color);
      border-radius: 10px;
      height: 8px;
      width: 100%;
      margin-bottom: 8px;
      overflow: hidden;
    }
    .progress-bar {
      background-color: var(--accent-secondary);
      height: 100%;
      border-radius: 10px;
      transition: width 0.5s ease-in-out;
    }
    .benefits {
      background: rgba(22, 199, 154, 0.1);
      border: 1px solid var(--accent-secondary);
      padding: 10px;
      border-radius: 5px;
      margin-top: 10px;
    }
    .benefits ul { margin-left: 15px; list-style-type: disc; font-size: 0.8rem; color: var(--accent-secondary); }
    .benefits ul li { margin-bottom: 3px; }
    .controls { margin-top: 15px; text-align: right; }
    .update-btn, .delete-btn {
      border: none;
      padding: 7px 12px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 600;
      margin-left: 8px;
      transition: background 0.3s ease, transform 0.2s ease;
      font-size: 0.85rem;
    }
    .update-btn { background: var(--border-color); color: var(--text-light); }
    .update-btn:hover { background: #5a5a8a; transform: translateY(-1px); }
    .delete-btn { background: var(--accent-primary); color: #fff; }
    .delete-btn:hover { background: #d73750; transform: translateY(-1px); }
    /* Calendar Section */
    .calendar-section {
      background: var(--card-bg);
      border-radius: 10px;
      padding: 25px;
      text-align: center;
      margin-top: 20px;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
    }
    .calendar-section h2 { border-bottom: none; font-size: 1.3rem; }
    .calendar-section p { color: var(--text-medium); margin-bottom: 15px; font-size: 0.9rem; }
    .calendar-section button {
      background: #4285F4;
      color: #fff;
      border: none;
      padding: 10px 18px;
      font-size: 0.9rem;
      font-weight: 600;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.2s ease;
    }
    .calendar-section button:hover { background: #357ae8; transform: translateY(-2px); }
    /* Modal Styles for Add/Edit Form */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.6);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 13;
    }
    .modal-overlay.active { display: flex; }
    .modal-content {
      background: var(--bg-dark-primary);
      padding: 25px 30px;
      border-radius: 8px;
      width: 90%;
      max-width: 500px;
      color: var(--text-light);
      position: relative;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
    }
    .modal-content h2 {
      margin-bottom: 15px;
      font-size: 1.5rem;
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 10px;
    }
    .modal-content input[type="text"],
    .modal-content input[type="number"],
    .modal-content input[type="date"],
    .modal-content select {
      width: 100%;
      padding: 12px 15px;
      margin-bottom: 15px;
      border: 1px solid var(--border-color);
      background-color: var(--bg-dark-secondary);
      color: var(--text-light);
      border-radius: 5px;
      font-size: 1rem;
      transition: border-color 0.3s ease;
    }
    .modal-content input::placeholder { color: var(--text-medium); opacity: 0.7; }
    .modal-content input:focus, .modal-content select:focus {
      outline: none;
      border-color: var(--accent-primary);
    }
    .modal-content button {
      width: 100%;
      background: var(--accent-primary);
      color: #fff;
      border: none;
      padding: 12px;
      font-size: 1.1rem;
      font-weight: 600;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.2s ease;
    }
    .modal-content button:hover { background: #d73750; transform: translateY(-2px); }
    .modal-close {
      position: absolute;
      top: 10px;
      right: 15px;
      background: transparent;
      border: none;
      font-size: 1.3rem;
      color: var(--text-medium);
      cursor: pointer;
    }
    /* Responsive Adjustments */
    @media (max-width: 768px) {
      .hero-title { font-size: 2.8rem; }
      .hero-container.shrink .hero-title { font-size: 1.6rem; }
      .tab { padding: 10px 15px; font-size: 0.9rem; }
    }
    @media (max-width: 600px) {
      .container { padding: 15px; }
      .hero-title { font-size: 2.2rem; }
      .hero-container.shrink .hero-title { font-size: 1.4rem; }
      .hero-button { padding: 12px 25px; font-size: 1rem; }
      .tab { padding: 10px 5px; font-size: 0.8rem; }
      .book-details { font-size: 0.8rem; gap: 8px; }
      .controls button { padding: 6px 10px; font-size: 0.8rem; }
      .achievement .treeGraphic { max-width: 120px; }
    }
  </style>
</head>
<body>
  <!-- Theme Toggle Button -->
  <button class="theme-toggle" onclick="toggleTheme()">Toggle Theme</button>

  <!-- Hero Section -->
  <div class="hero-container" id="heroContainer">
    <h1 class="hero-title">Embark on Your Reading Journey</h1>
    <button class="hero-button" onclick="startJourney()">Let's Begin</button>
  </div>

  <!-- Floating Add Book Button (always visible on Library view) -->
  <button class="floating-add-btn" onclick="openModal()">Add Book</button>

  <!-- Main Content Area -->
  <div class="container" id="mainContainer">
    <!-- Last Visited Tracker & Motivational Quote -->
    <p id="lastVisited"></p>
    <section class="motivational-quote">
      <p id="quoteText">Loading quote...</p>
    </section>

    <!-- Achievement Section (Growth Tree) -->
    <section class="achievement" id="achievementSection">
      <h3>Your Growth Tree</h3>
      <p id="achievementMessage">Let's start reading!</p>
      <div id="treeGraphic" class="treeGraphic"></div>
    </section>

    <!-- Tabs -->
    <div class="tabs">
      <div class="tab active" onclick="switchTab('library')">My Library</div>
      <div class="tab" onclick="switchTab('sync')">Calendar Sync</div>
    </div>

    <!-- Tab Contents -->
    <div class="tab-contents">
      <!-- Library Tab -->
      <div class="tab-content active" data-tab="library">
        <section class="book-list">
          <h2>Your Bookshelf</h2>
          <div id="booksContainer">
            <p style="text-align: center; color: var(--text-medium); padding: 20px 0;">Loading your books...</p>
          </div>
        </section>
      </div>
      <!-- Calendar Sync Tab -->
      <div class="tab-content" data-tab="sync">
        <section class="calendar-section">
          <h2>Google Calendar Sync</h2>
          <p>Connect your reading sessions to your calendar (Feature coming soon!).</p>
          <button id="syncCalendar">Sync with Google Calendar</button>
        </section>
      </div>
    </div>
  </div>

  <!-- Modal for Add/Edit Book Form -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal-content">
      <button class="modal-close" onclick="closeModal()">&times;</button>
      <h2 id="modalTitle">Add Book</h2>
      <form id="bookForm">
        <input type="hidden" id="bookEditIndex" value="-1" />
        <select id="bookCategory" required>
            <option value="" disabled selected>Select Category</option>
            <option value="Mindset & Growth">Mindset & Growth</option>
            <option value="Productivity & Focus">Productivity & Focus</option>
            <option value="Social Skills & Influence">Social Skills & Influence</option>
            <option value="Habits & Systems">Habits & Systems</option>
            <option value="Stoicism & Philosophy">Stoicism & Philosophy</option>
            <option value="Fiction & Literature">Fiction & Literature</option>
            <option value="Technology & Science">Technology & Science</option>
            <option value="Other">Other</option>
        </select>
        <input type="text" id="bookTitle" placeholder="Book Title" required />
        <input type="number" id="bookProgress" placeholder="Progress (in %)" min="0" max="100" required />
        <input type="date" id="lastRead" placeholder="Last Read Date" />
        <input type="number" id="bookStreak" placeholder="Reading Streak (days)" min="0" />
        <button type="submit" id="saveButton">Add Book</button>
      </form>
    </div>
  </div>

  <script>
    // --- Theme Toggle ---
    function toggleTheme() {
      document.body.classList.toggle('light-theme');
      alert("Theme toggling needs full light mode CSS implementation.");
    }
    // --- Hero Interaction ---
    let heroShrunk = false;
    function startJourney() {
      if (!heroShrunk) {
        document.getElementById('heroContainer').classList.add('shrink');
        document.getElementById('mainContainer').classList.add('visible');
        heroShrunk = true;
      }
    }
    // --- Tab Switching ---
    function switchTab(tabName) {
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      document.querySelector(`.tab[onclick="switchTab('${tabName}')"]`).classList.add('active');
      document.querySelector(`.tab-content[data-tab="${tabName}"]`).classList.add('active');
    }
    // --- Motivational Quotes ---
    const quotes = [
        "The more that you read, the more things you will know...",
        "Reading is essential for those who seek to rise above the ordinary.",
        "A reader lives a thousand lives before he dies...",
        "Books are a uniquely portable magic.",
        "Wear the old coat and buy the new book.",
        "Reading gives us someplace to go when we have to stay where we are.",
        "Develop a passion for learning. If you do, you will never cease to grow."
    ];
    function displayRandomQuote() {
      const quoteEl = document.getElementById('quoteText');
      if (quoteEl) {
        const randomIndex = Math.floor(Math.random() * quotes.length);
        quoteEl.textContent = `"${quotes[randomIndex]}"`;
      }
    }
    // --- Last Visited ---
    function updateLastVisited() {
      const lastVisitedEl = document.getElementById('lastVisited');
      if (lastVisitedEl) {
        const lastVisited = localStorage.getItem('lastVisited');
        const now = new Date().toLocaleString();
        lastVisitedEl.textContent = lastVisited ? "Last visit: " + lastVisited : "Welcome to your Reading Journey!";
        localStorage.setItem('lastVisited', now);
      }
    }
    // --- Book Management ---
    function getBooks() {
      return JSON.parse(localStorage.getItem('books')) || [];
    }
    function saveBooks(books) {
      localStorage.setItem('books', JSON.stringify(books));
    }
    // --- Benefits Mapping ---
    const benefitsMapping = {
      "deep work": ["Improved focus", "Distraction management"],
      "hyperfocus": ["Channel attention", "Targeted focus"],
      "mindset": ["Growth mindset", "Resilience"],
      "the art of seduction": ["Social dynamics", "Charisma"],
      "lok vyavhar": ["Social etiquette", "Communication"],
      "jeet aapki": ["Self-confidence", "Positive attitude"],
      "lives of the stoics (ryan holiday)": ["Emotional resilience", "Handling adversity"],
      "mastery": ["Pursuit of excellence", "Continuous learning"],
      "atomic habits": ["Habit formation", "Building systems"]
    };
    function getBenefits(title) {
      const key = title.toLowerCase().trim();
      return benefitsMapping[key] || [];
    }
    // --- Initialize Default Books ---
    function initializeBooks() {
      const defaultBooks = [
        { title: "Atomic Habits", progress: 50, lastRead: "2023-10-26", streak: 5, category: "Habits & Systems" },
        { title: "Mindset", progress: 20, lastRead: "2023-10-20", streak: 1, category: "Mindset & Growth" },
        { title: "Deep Work", progress: 75, lastRead: "2023-10-25", streak: 3, category: "Productivity & Focus" }
      ];
      if (!localStorage.getItem('books')) {
        saveBooks(defaultBooks);
      } else {
        let books = getBooks();
        let updated = false;
        books = books.map(book => {
          if (!book.category) { book.category = "Other"; updated = true; }
          book.progress = Number(book.progress) || 0;
          book.streak = Number(book.streak) || 0;
          return book;
        });
        if (updated) { saveBooks(books); }
      }
    }
    // --- Achievement Status (Growth Tree) ---
    function updateAchievementStatus() {
      const books = getBooks();
      let totalProgress = 0;
      let count = books.length;
      books.forEach(book => { totalProgress += Number(book.progress); });
      let avgProgress = count > 0 ? Math.round(totalProgress / count) : 0;
      let message = "";
      let treeSVG = "";
      if (avgProgress < 10) { message = `Seedling (${avgProgress}% avg): Keep nurturing!`; treeSVG = `<svg viewBox="0 0 100 100"><line x1="50" y1="85" x2="50" y2="60" stroke-width="5"/><circle cx="50" cy="50" r="15"/></svg>`; }
      else if (avgProgress < 30) { message = `Sapling (${avgProgress}% avg): Taking root!`; treeSVG = `<svg viewBox="0 0 100 100"><rect x="46" y="60" width="8" height="25"/><circle cx="50" cy="45" r="20"/><circle cx="35" cy="50" r="8" class="leaf-dark"/></svg>`; }
      else if (avgProgress < 60) { message = `Young Tree (${avgProgress}% avg): Flourishing!`; treeSVG = `<svg viewBox="0 0 100 100"><rect x="44" y="55" width="12" height="30"/><circle cx="50" cy="40" r="25"/><circle cx="30" cy="45" r="10"/><circle cx="70" cy="45" r="10" class="leaf-dark"/></svg>`; }
      else if (avgProgress < 90) { message = `Blooming Tree (${avgProgress}% avg): Dedication shines!`; treeSVG = `<svg viewBox="0 0 100 100"><rect x="42" y="50" width="16" height="35"/><circle cx="50" cy="35" r="30"/><circle cx="25" cy="40" r="12"/><circle cx="75" cy="40" r="12" class="leaf-dark"/><circle cx="50" cy="15" r="10"/></svg>`; }
      else { message = `Mighty Oak (${avgProgress}% avg): Mastery!`; treeSVG = `<svg viewBox="0 0 100 100"><rect x="40" y="45" width="20" height="40"/><circle cx="50" cy="30" r="35"/><circle cx="20" cy="35" r="15"/><circle cx="80" cy="35" r="15" class="leaf-dark"/><circle cx="50" cy="5" r="12"/></svg>`; }
      const messageEl = document.getElementById('achievementMessage');
      const graphicEl = document.getElementById('treeGraphic');
      if (messageEl) messageEl.textContent = message;
      if (graphicEl) graphicEl.innerHTML = treeSVG;
    }
    // --- Render Books by Category ---
    function renderBooks() {
      const books = getBooks();
      const container = document.getElementById('booksContainer');
      if (!container) return;
      container.innerHTML = '';
      const booksByCategory = books.reduce((acc, book) => {
        const category = book.category || 'Other';
        if (!acc[category]) acc[category] = [];
        acc[category].push(book);
        return acc;
      }, {});
      const categoryOrder = [
        "Mindset & Growth",
        "Productivity & Focus",
        "Habits & Systems",
        "Social Skills & Influence",
        "Stoicism & Philosophy",
        "Fiction & Literature",
        "Technology & Science",
        "Other"
      ];
      let contentRendered = false;
      categoryOrder.forEach(category => {
        if (booksByCategory[category]) {
          contentRendered = true;
          const categoryCard = document.createElement('div');
          categoryCard.className = 'category-card';
          categoryCard.innerHTML = `<h3>${category}</h3><ul></ul>`;
          const bookList = categoryCard.querySelector('ul');
          booksByCategory[category].forEach(book => {
            const originalIndex = books.findIndex(b => b.title === book.title && b.category === book.category);
            const li = document.createElement('li');
            li.className = 'book-item';
            const benefits = getBenefits(book.title);
            let benefitsHTML = benefits.length > 0 ? `<div class="benefits"><strong>Key Takeaways:</strong><ul>${benefits.map(b => `<li>${b}</li>`).join('')}</ul></div>` : "";
            li.innerHTML = `
              <h4>${book.title}</h4>
              <div class="progress-bar-container">
                <div class="progress-bar" style="width: ${book.progress}%;"></div>
              </div>
              <div class="book-details">
                <small>Progress: ${book.progress}%</small>
                <small>Last Read: ${book.lastRead ? new Date(book.lastRead).toLocaleDateString() : "N/A"}</small>
                <small>Streak: <span class="streak">${book.streak || 0} day(s)</span></small>
              </div>
              ${benefitsHTML}
              <div class="controls">
                <button class="update-btn" onclick="editBook(${originalIndex})">Edit</button>
                <button class="delete-btn" onclick="deleteBook(${originalIndex})">Delete</button>
              </div>
            `;
            bookList.appendChild(li);
          });
          container.appendChild(categoryCard);
        }
      });
      if (!contentRendered && books.length > 0) {
        container.innerHTML = '<p style="text-align: center; color: var(--text-medium); padding: 20px 0;">Your library is empty. Add a book using the Add Book button!</p>';
      }
      updateAchievementStatus();
    }
    // --- Modal Functions ---
    function openModal() {
      document.getElementById('modalOverlay').classList.add('active');
      document.getElementById('modalTitle').textContent = "Add Book";
      resetForm();
    }
    function closeModal() {
      document.getElementById('modalOverlay').classList.remove('active');
    }
    // --- Form Submission (Modal) ---
    document.getElementById('bookForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const title = document.getElementById('bookTitle').value.trim();
      const category = document.getElementById('bookCategory').value;
      const progress = document.getElementById('bookProgress').value;
      const lastRead = document.getElementById('lastRead').value;
      const streak = document.getElementById('bookStreak').value || 0;
      const editIndex = parseInt(document.getElementById('bookEditIndex').value, 10);
      if (!title || !category || progress === "") return;
      let books = getBooks();
      const bookData = { title, category, progress: Number(progress), lastRead, streak: Number(streak) };
      if (editIndex > -1) {
        books[editIndex] = bookData;
      } else {
        books.push(bookData);
      }
      saveBooks(books);
      renderBooks();
      closeModal();
    });
    function resetForm() {
      document.getElementById('bookForm').reset();
      document.getElementById('bookEditIndex').value = "-1";
      document.getElementById('bookCategory').value = "";
      document.getElementById('saveButton').textContent = "Add Book";
    }
    // --- Edit Book ---
    function editBook(index) {
      const books = getBooks();
      if (index < 0 || index >= books.length) return;
      const book = books[index];
      document.getElementById('bookTitle').value = book.title;
      document.getElementById('bookCategory').value = book.category || 'Other';
      document.getElementById('bookProgress').value = book.progress;
      document.getElementById('lastRead').value = book.lastRead;
      document.getElementById('bookStreak').value = book.streak || 0;
      document.getElementById('bookEditIndex').value = index;
      document.getElementById('saveButton').textContent = "Update Book";
      document.getElementById('modalTitle').textContent = "Edit Book";
      openModal();
    }
    // --- Delete Book ---
    function deleteBook(index) {
      if (confirm("Are you sure you want to delete this book entry?")) {
          let books = getBooks();
          if (index >= 0 && index < books.length) {
              books.splice(index, 1);
              saveBooks(books);
              renderBooks();
              resetForm();
          }
      }
    }
    // --- Calendar Placeholder ---
    document.getElementById('syncCalendar').addEventListener('click', function() {
      alert("Google Calendar integration feature coming soon!");
    });
    // --- Initialize Application ---
    document.addEventListener('DOMContentLoaded', () => {
        updateLastVisited();
        displayRandomQuote();
        initializeBooks();
        renderBooks();
        updateAchievementStatus();
        switchTab('library');
    });
  </script>
</body>
</html>
